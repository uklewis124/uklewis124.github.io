<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Data</title>
    <script>
        function getJsonFromUrl() {
            var query = window.location.search.substring(1);
            if (query) {
                var dataParam = query.split('=')[1];
                if (dataParam) {
                    try {
                        return JSON.parse(decodeURIComponent(dataParam));
                    } catch (error) {
                        console.error('Error parsing JSON:', error);
                        return null;
                    }
                }
            }
            return null;
        }

        document.addEventListener('DOMContentLoaded', function() {
            var data = getJsonFromUrl();
            var error = decodeURIComponent(window.location.search.split('error=')[1]);
            
            if (error) {
                document.getElementById('error').textContent = error;
                document.getElementById('userData').style.display = 'none'; // Hide user data if error
                document.getElementById('signinPrompt').style.display = 'none'; // Hide sign-in prompt
            } else if (data) {
                document.getElementById('username').textContent = data.username || '';
                document.getElementById('result').textContent = data.result || '';
                document.getElementById('total_mark').textContent = data.total_mark || '';
                document.getElementById('reason').textContent = data.reason || '';
                document.getElementById('signinPrompt').style.display = 'none'; // Hide sign-in prompt
            } else {
                document.getElementById('error').textContent = 'Unknown error occurred';
                document.getElementById('userData').style.display = 'none'; // Hide user data section
                document.getElementById('signinPrompt').style.display = 'block'; // Display sign-in prompt
            }
        });

        function redirectToOAuth() {
            window.location.href = 'https://afternoon-anchorage-24876-7a0d5f5b0baf.herokuapp.com/auth/discord';
        }
    </script>
</head>
<body>
    <h1>User Data</h1>
    <div id="userData">
        <p>Username: <span id="username"></span></p>
        <p>Result: <span id="result"></span></p>
        <p>Total Mark: <span id="total_mark"></span></p>
        <p>Reason: <span id="reason"></span></p>
    </div>
    <div id="error"></div>
    
    <div id="signinPrompt" style="display: none;">
        <p>You are not logged in.</p>
        <button onclick="redirectToOAuth()">Sign in with Discord</button>
    </div>
</body>
</html>
